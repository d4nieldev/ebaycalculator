{% extends 'base.html' %}
{% block title %}Panel{% endblock %}
{% block content %}
<div class="container-fluid my-3">
    <!--Filter Sales-->
    <form method="POST" action="">
        {% csrf_token %}
        <div class="row">
            <div class="col-1">
                <select class='form-select' name="s_filter_sales_by_date" id="s_sales_filter_by_date">
                    <option value="all">All sales</option>
                    {% for year, month_list in years_months.items %}
                        {% for month in month_list %}
                            {% if user_sales_filtered_y == year and user_sales_filtered_m == month %}
                                <option value="{{ year }}-{{ month }}" selected>{{ year }}-{{ month }}</option>
                            {% else %}
                                <option value="{{ year }}-{{ month }}">{{ year }}-{{ month }}</option>
                            {% endif %}
                        {% endfor %}
                    {% endfor %}
                </select>
            </div>
            <div class="col-1">
                <input type="submit" class="btn btn-secondary" name="btn_select_date" value="Filter">
            </div>
        </div>
    </form>

    <!--View Sales-->
    <table class="table table-dark table-striped">
        <thead>
            <!--Titles-->
          <tr>
            <th scope="col">Date</th>
            <th scope="col">eBay Price</th>
            <th scope="col">Amazon Price</th>
            <th scope="col">eBay Tax</th>
            <th scope="col">Paypal Tax</th>
            <th scope="col">TM Fee</th>
            <th scope="col">Promoted</th>
            <th scope="col">Profit</th>
          </tr>
        </thead>
        <tbody>
            <!--Data-->
          {% for sale in user_sales %}
          <tr>
            <th>{{ sale.date }}</th>
            <td>{{ sale.ebay_price }}</td>
            <td>{{ sale.amazon_price }}</td>
            <td>{{ sale.ebay_tax }}</td>
            <td>{{ sale.paypal_tax }}</td>
            <td>{{ sale.tm_fee }}</td>
            <td>{{ sale.promoted }}</td>
            <td id="loop">{{ sale.profit }}</td>
          </tr>
          {% endfor %}
          
          <!--Register Sale-->
          <form method="POST" action="">
            {% csrf_token %}
            <tr>
                {% for field in form %}
                <td>
                    {{ field }}
                </td>
                {% endfor %}
                <td><input class="btn btn-primary" type="submit" display="inline" name="btn_register_sale"></td>
            </tr>
            
            
          </form>
        </tbody>
    </table>

    <!--Sale Registered Message-->
    {% for message in messages %}
        {% if message.tags == 'info' %}
            <p class='alert alert-info mt-3'>{{ message }}</p>
        {% endif %}
    {% endfor %}

    <!--Stats-->
    Total Profit: <span id="total"></span>
</div>

<script>
    function calc_profit() {
        // This functinon calculates the profit from all the other inputs
        // outputs to id=f_profit
        ebay_price = document.getElementById('f_ebay_price').value;
        amazon_price = document.getElementById('f_amazon_price').value;
        ebay_tax = document.getElementById('f_ebay_tax').value;
        paypal_tax = document.getElementById('f_paypal_tax').value;
        tm_fee = document.getElementById('f_tm_fee').value;
        promoted = document.getElementById('f_promoted').value;
        document.getElementById('f_profit').value = ebay_price - amazon_price - ebay_tax - paypal_tax - tm_fee - promoted;
    }

    $(function() {
            // This function calculates all of the profit values and sums it up
            // outputs to id=total
            var TotalValue = 0;

            $("tr #loop").each(function(index,value){
            currentRow = parseFloat($(this).text());
            TotalValue += currentRow
            });

            document.getElementById('total').innerHTML = TotalValue;

        });
</script>
{% endblock %}